<?xml version="1.0" encoding="UTF-8"?>
<xml>
    <config>
        <serviceUrl>http://{prompt:Host name:}/</serviceUrl>
        <partnerId>-2</partnerId>
        <clientTag>Stand alone php 1.0.0</clientTag>
        <curlTimeout>30</curlTimeout>
        <userAgent>Stand alone php 1.0.0</userAgent>
    </config>

	<multirequest>
		<request service="eventNotificationTemplate" action="add" plugin="eventNotification" partnerId="0">
			<template objectType="KalturaHttpNotificationTemplate">
				<name>Metadata Field Equals</name>
				<systemName>HTTP_METADATA_FIELD_EQUALS</systemName>
				<description>HTTP notification template to be sent when a custom metadata field changed to specific value.</description>
				<automaticDispatchEnabled>1</automaticDispatchEnabled>
				<eventType>6</eventType> <!-- EventNotificationEventType::OBJECT_DATA_CHANGED -->
				<eventObjectType>metadataEventNotifications.Metadata</eventObjectType> <!-- EventNotificationEventObjectType::METADATA -->
				<eventConditions objectType="array">
					<item objectType="KalturaFieldMatchCondition">
						<description>Object type is entry</description>
						<field objectType="KalturaEvalStringField">
							<code>$scope->getObject()->getObjectType()</code>
						</field>
						<values objectType="array">
							<item objectType="KalturaStringValue">
								<value>1</value>
							</item>
						</values>
					</item>
				</eventConditions>
				<contentParameters objectType="array">
					<item objectType="KalturaEventNotificationParameter">
						<key>from_email</key>
						<description>Sender email</description>
						<value objectType="KalturaEvalStringField">
							<code>kConf::get("partner_notification_email")</code>
						</value>
					</item>
					<item objectType="KalturaEventNotificationParameter">
						<key>from_name</key>
						<description>Sender name</description>
						<value objectType="KalturaEvalStringField">
							<code>kConf::get("partner_notification_name")</code>
						</value>
					</item>
					<item objectType="KalturaEventNotificationParameter">
						<key>creator_name</key>
						<description>Entry creator name</description>
						<value objectType="KalturaEvalStringField">
							<code>!is_null(entryPeer::retrieveByPk($scope->getObject()->getObjectId())) ? entryPeer::retrieveByPk($scope->getObject()->getObjectId())->getkuser()->getFirstName() . ' ' . entryPeer::retrieveByPk($scope->getObject()->getObjectId())->getkuser()->getLastName() : ''</code>
						</value>
					</item>
					<item objectType="KalturaEventNotificationParameter">
						<key>creator_id</key>
						<description>Entry creator ID</description>
						<value objectType="KalturaEvalStringField">
							<code>!is_null(entryPeer::retrieveByPk($scope->getObject()->getObjectId())) ? entryPeer::retrieveByPk($scope->getObject()->getObjectId())->getKuserId() : ''</code>
						</value>
					</item>
					<item objectType="KalturaEventNotificationParameter">
						<key>creator_email</key>
						<description>Entry creator email</description>
						<value objectType="KalturaEvalStringField">
							<code>!is_null(entryPeer::retrieveByPk($scope->getObject()->getObjectId())) ? entryPeer::retrieveByPk($scope->getObject()->getObjectId())->getkuser()->getEmail() : ''</code>
						</value>
					</item>
					<item objectType="KalturaEventNotificationParameter">
						<key>owner_name</key>
						<description>Account owner name</description>
						<value objectType="KalturaEvalStringField">
							<code>!is_null(entryPeer::retrieveByPk($scope->getObject()->getObjectId())) ? entryPeer::retrieveByPk($scope->getObject()->getObjectId())->getPartner()->getPartnerName() : ''</code>
						</value>
					</item>
					<item objectType="KalturaEventNotificationParameter">
						<key>owner_email</key>
						<description>Account owner email</description>
						<value objectType="KalturaEvalStringField">
							<code>!is_null(entryPeer::retrieveByPk($scope->getObject()->getObjectId())) ? entryPeer::retrieveByPk($scope->getObject()->getObjectId())->getPartner()->getAdminEmail() : ''</code>
						</value>
					</item>
					<item objectType="KalturaEventNotificationParameter">
						<key>metadata_id</key>
						<description>Metadata ID</description>
						<value objectType="KalturaEvalStringField">
							<code>$scope->getObject()->getId()</code>
						</value>
					</item>
					<item objectType="KalturaEventNotificationParameter">
						<key>entry_id</key>
						<description>Entry ID</description>
						<value objectType="KalturaEvalStringField">
							<code>!is_null(entryPeer::retrieveByPk($scope->getObject()->getObjectId())) ? $scope->getObject()->getObjectId() : ''</code>
						</value>
					</item>
					<item objectType="KalturaEventNotificationParameter">
						<key>entry_name</key>
						<description>Entry name</description>
						<value objectType="KalturaEvalStringField">
							<code>!is_null(entryPeer::retrieveByPk($scope->getObject()->getObjectId())) ? entryPeer::retrieveByPk($scope->getObject()->getObjectId())->getName() : ''</code>
						</value>
					</item>
				</contentParameters>
				<data objectType="KalturaHttpNotificationObjectData">
					
					<apiObjectType>KalturaBaseEntry</apiObjectType>
					<code>(($scope->getObject()->getObjectType() == 1) ? entryPeer::retrieveByPk($scope->getObject()->getObjectId()): null)</code>
			
				</data>
				
				<method>2</method> <!-- KalturaHttpNotificationMethod::POST -->
			</template>
		</request>
		<request service="eventNotificationTemplate" action="updateStatus" plugin="eventNotification" partnerId="0">
			<id>{1:result:id}</id>
			<status>1</status><!-- EventNotificationTemplateStatus::DISABLED -->
		</request>
	</multirequest>
</xml>
                